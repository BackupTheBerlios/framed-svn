<?xml version="1.0"?>

<!DOCTYPE page-specification PUBLIC 
  "-//Apache Software Foundation//Tapestry Specification 4.0//EN" 
  "http://jakarta.apache.org/tapestry/dtd/Tapestry_4_0.dtd">
  
<page-specification class="net.addictivesoftware.album.pages.Album">
	<inject property="request" object="infrastructure:request"/>

	<property name="file" />
	
	<property name="selectedFile" persist="session"/>
	
	<property name="fileState" persist="session" initial-value="ognl: new java.util.HashSet()" />
	
	<component id="nodeLink" type="tacos:PartialLink" >
	    <binding name="listener" value="ognl:components.tree.listeners.contentExpansion" />
		<binding name="parameters" value="ognl:{keyProvider.getKey(components.tree.value), not components.tree.isExpanded(components.tree.value),file.path}"/>
	    <binding name="refreshParts" value="ognl:new java.lang.String[] { file.path, 'selectedFile' }" />
		<binding name="renderer" value="ognl:@net.sf.tacos.link.FixPosLinkRenderer@INSTANCE"/>
		<binding name="stateful">false</binding>
	</component>
	
	<component id="nodeLabel" type="Insert">
		<binding name="value" value="ognl:file.name"/>
		<binding name="class" value="ognl:file == selectedFile ? 'selected' : null"/>
	</component>
	
	<bean name="evenOdd" class="org.apache.tapestry.bean.EvenOdd" />
	
	<component id="tree" type="tacos:Tree">
		<binding name="contentProvider" value="ognl:contentProvider"/>
		<binding name="keyProvider" value="ognl:keyProvider"/>
		<binding name="value" value="ognl:file"/>
		<binding name="state" value="ognl:fileState"/>
		<binding name="sorter" value="ognl:@net.sf.tacos.demo.tree.fs.FileComparator@INSTANCE"/>
		<binding name="rowStyle" value="ognl:beans.evenOdd" />
		<binding name="linkListener" value="listener:select" />
	</component>
	
	<component id="icon" type="Thumb">
		<binding name="image" value="file.path"/>
	</component>
    
	<component id="icon_old" type="Image">
		<binding name="image" value="dynamicAsset"/>
	</component>

        <asset name="icon" path="img/item.png" />
	
    <asset name="folder" path="img/folder.png" />
    
    <component id="foto" type="Foto">
    	<binding name="image" value="ognl:selectedFile == null ? '/Album/img/noselected.jpg' : selectedFile.path" />
    </component>
        
</page-specification>